{% extends "base.html" %}
{% block title %}Machines{% endblock %}

{% block content %}
<div class="card" style="padding-bottom:24px">

  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2 style="margin:0">Machines</h2>

    {% if is_admin %}
      <a class="btn" href="{{ url_for('add_machine') }}">➕ Add Machine</a>
    {% endif %}
  </div>

  <div style="margin-top:12px;">
    <table class="table" style="width:100%;table-layout:fixed;">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Type</th>
          <th style="width:25%">Location</th>
          <th style="width:10%">Status</th>
          {% if is_admin %}<th style="width:18%">Actions</th>{% endif %}
        </tr>
      </thead>

      <tbody>
        {% for m in machines %}
        <tr>
          <td>{{ m[0] }}</td>
          <td>{{ m[1] }}</td>
          <td>{{ m[2] }}</td>
          <td>{{ m[3] }}</td>
          <td>{{ m[4] }}</td>
          
          {% if is_admin %}
          <td style="display:flex;gap:10px;">

            <!-- MODIFY BUTTON -->
            <a class="btn small" style="flex:1;text-align:center;" 
               href="{{ url_for('modify_machine', mid=m[0]) }}">
              Modify
            </a>

            <!-- SAFE DELETE BUTTON -->
            <form method="post" 
                  action="{{ url_for('delete_machine', mid=m[0]) }}" 
                  style="flex:1;"
                  onsubmit="return confirm('⚠️ This will delete the machine AND all linked data (performance, anomalies, alerts, maintenance).\n\nAre you sure?');">

              <button class="btn small" type="submit"
                style="width:100%;background:#fff;color:#d7263d;font-weight:700;border:1px solid rgba(220,0,0,0.25);">
                Delete
              </button>

            </form>

          </td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
